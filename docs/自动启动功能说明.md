# 自动启动功能使用说明

## 概述

新的自动启动功能让你可以在UI界面中轻松设置机器人的每日自动启动时间，无需手动编辑bat文件或Windows计划任务。系统会自动为你处理所有底层操作。

## 功能特点

✅ **用户友好** - 在UI中直接设置，无需了解Windows计划任务
✅ **自动化** - 系统自动创建和管理bat文件及计划任务
✅ **可视化管理** - 清晰查看所有机器人的自动启动状态
✅ **独立架构** - 核心逻辑封装在独立模块中，避免上帝类

## 使用方法

### 1. 打开自动启动界面

1. 启动 `UI入口.py`
2. 在右侧选项卡中点击 **"自动启动"**
3. 界面会自动加载所有已配置的机器人

### 2. 设置机器人自动启动

对于每个机器人，你可以：

1. **勾选"启用自动启动"** - 启用该机器人的自动启动功能
2. **设置启动时间** - 使用时间选择器设置每日启动时间（24小时制）
   - 小时：0-23
   - 分钟：0-59
3. **选择虚拟环境** - 如果使用虚拟环境，请勾选"使用虚拟环境"
4. **点击"应用"按钮** - 保存该机器人的设置

### 3. 批量操作

- **保存所有设置** - 一键保存所有机器人的配置
- **刷新机器人列表** - 重新加载机器人列表和配置
- **清理无效配置** - 删除已经失效的计划任务配置

### 4. 删除自动启动

如果想取消某个机器人的自动启动：

1. 取消勾选"启用自动启动"
2. 点击"应用"按钮

或者直接点击该机器人配置项的"删除"按钮。

## 状态说明

界面会显示每个机器人的当前状态：

- ✓ **已设置自动启动 (时间)** - 绿色，表示计划任务已成功创建
- ⚠ **配置存在但计划任务丢失** - 橙色，配置文件存在但Windows计划任务被手动删除了
- **未配置** - 灰色，还未设置自动启动
- **已启用（未保存）** - 橙色，已勾选但未点击应用
- **已禁用（未保存）** - 灰色，已取消勾选但未点击应用
- ✗ **设置失败** / **错误** - 红色，操作失败

## 技术架构

### 核心模块

#### 1. `模块/自动启动管理器.py`
负责管理Windows计划任务的底层操作：
- 创建/删除计划任务
- 生成启动bat文件
- 保存/读取配置文件
- 检查任务状态

#### 2. `界面/自动启动界面.py`
提供用户友好的UI界面：
- 显示所有机器人及其配置
- 时间选择器
- 状态可视化
- 批量操作

### 生成的文件

- **配置文件**: `自动启动配置.json` - 存储所有机器人的自动启动配置
- **bat文件**: `自动启动脚本/启动_机器人标识.bat` - 每个机器人的启动脚本
- **计划任务**: Windows计划任务，名称格式为 `COC_Robot_机器人标识`

## 与旧版本的对比

### 旧版本（自动启动设置.py）
❌ 需要手动填写多个参数
❌ 需要理解计划任务概念
❌ 需要手动输入任务名称和时间
❌ 配置繁琐，容易出错

### 新版本（自动启动界面）
✅ 在UI中一键设置
✅ 自动管理所有底层细节
✅ 可视化状态反馈
✅ 批量操作支持
✅ 与机器人管理无缝集成

## 常见问题

### Q: 如何查看创建的计划任务？
A: 打开Windows任务计划程序（`taskschd.msc`），查找名称以 `COC_Robot_` 开头的任务。

### Q: 可以设置多个机器人在不同时间启动吗？
A: 可以！每个机器人可以设置独立的启动时间。

### Q: 如果手动删除了Windows计划任务会怎样？
A: 界面会显示警告状态"配置存在但计划任务丢失"，你可以重新点击"应用"来重建计划任务。

### Q: bat文件保存在哪里？
A: 所有bat文件保存在项目根目录下的 `自动启动脚本/` 文件夹中。

### Q: 可以自定义bat文件内容吗？
A: 目前bat文件是自动生成的，如果需要自定义，可以直接修改 `模块/自动启动管理器.py` 中的 `_生成bat文件` 方法。

### Q: 如何完全卸载自动启动功能？
A:
1. 在界面中删除所有机器人的自动启动配置
2. 或者点击"清理无效配置"按钮
3. 手动删除 `自动启动配置.json` 和 `自动启动脚本/` 文件夹

## 开发者说明

### 扩展功能

如果你想添加更多功能，可以：

1. **修改 `自动启动管理器`** - 添加新的计划任务管理方法
2. **修改 `自动启动界面`** - 添加新的UI控件和交互
3. **集成到其他界面** - 在其他地方调用 `自动启动管理器` 的API

### API示例

```python
from 模块.自动启动管理器 import 自动启动管理器

管理器 = 自动启动管理器()

# 设置自动启动
管理器.设置机器人自动启动("机器人1", "09:00", 使用虚拟环境=True)

# 获取配置
配置 = 管理器.获取机器人自动启动状态("机器人1")

# 取消自动启动
管理器.取消机器人自动启动("机器人1")

# 更新时间
管理器.更新机器人启动时间("机器人1", "10:00")
```

## 更新日志

### v1.0 (当前版本)
- 初始版本发布
- 基础的自动启动设置功能
- UI界面集成
- 配置文件管理
- 批量操作支持

## 反馈与支持

如有问题或建议，请在项目中提交Issue。

---

**本项目仅供技术学习与研究** ⚠️
