# 命令行使用指南

> **💡 提示**：如果你是普通用户，推荐使用 [📅 自动启动功能](自动启动功能说明.md)，在UI界面中轻松设置每日自动启动，无需了解命令行！
>
> 本文档适合**高级用户**，需要更灵活的控制方式或熟悉命令行的用户。

---

## 📋 目录

1. [脚本作用](#脚本作用)
2. [准备工作](#准备工作)
3. [快速开始 - 编写BAT启动文件](#快速开始---编写bat启动文件)
4. [命令行参数详解](#命令行参数详解)
5. [设置Windows计划任务](#设置windows计划任务)
6. [常见问题](#常见问题)

---

## 脚本作用

`主入口.py` 是项目的命令行入口，可以帮你：

✅ **批量启动机器人** - 一次启动一个或多个机器人
✅ **灵活参数配置** - 每个机器人可单独设置运行策略
✅ **自动监控重启** - 机器人卡死时自动重启
✅ **计划任务支持** - 配合Windows计划任务实现定时启动

> **对比新功能**：
> - 新的[自动启动功能](自动启动功能说明.md)在UI界面中设置，更简单
> - 命令行方式更灵活，但需要手动编写BAT文件

---

## 准备工作

确保你已经：

1. ✅ 通过 `UI入口.py` 正确配置过机器人
2. ✅ 模拟器和游戏可以正常启动
3. ✅ 了解你的机器人标识（在UI配置管理中创建的名称）

---

## 快速开始 - 编写BAT启动文件

### 方式一：使用现有机器人配置（推荐）

如果你已经在UI中配置好了机器人，只需要启动它们：

```bat
@echo off
REM 切换到程序目录
cd /d %~dp0

REM 启动已配置的机器人（只写标志，使用UI中的配置）
python 主入口.py ^
    --机器人 标志=主号 ^
    --机器人 标志=小号1 ^
    --机器人 标志=小号2

pause
```

### 方式二：启动时覆盖配置

如果需要临时修改某些参数：

```bat
@echo off
cd /d %~dp0

REM 启动机器人并覆盖部分配置
python 主入口.py ^
    --机器人 标志=主号 刷墙 刷夜世界 ^
    --机器人 标志=小号1 最小资源=300000

pause
```

### 方式三：使用虚拟环境启动

如果你使用了虚拟环境：

```bat
@echo off
cd /d %~dp0

REM 激活虚拟环境
call .venv\Scripts\activate.bat

REM 启动机器人
python 主入口.py ^
    --机器人 标志=主号 ^
    --机器人 标志=小号1

pause
```

### 保存BAT文件

1. 将上述代码复制到记事本
2. 保存为 `启动机器人.bat`（注意文件扩展名必须是 `.bat`）
3. 放在项目根目录（`coc_robot`文件夹内）
4. 双击运行即可启动

---

## 命令行参数详解

### 基础格式

```bash
python 主入口.py --机器人 [参数1] [参数2] ...
```

### 必填参数

| 参数 | 格式 | 说明 | 示例 |
|------|------|------|------|
| `标志` | `标志=XXX` | **必填**，机器人唯一标识 | `标志=主号` |

### 可选参数

| 参数 | 格式 | 类型 | 说明 |
|------|------|------|------|
| `雷电索引` | `雷电索引=数字` | 整数 | 对应雷电模拟器索引，默认从UI配置读取 |
| `服务器` | `服务器=国际服` | 文本 | 游戏服务器，默认`国际服` |
| `最小资源` | `最小资源=数字` | 整数 | 进攻最小资源要求 |
| `边缘比例` | `边缘比例=0.6` | 小数 | 资源建筑靠边比例（0-1） |
| `刷墙` | `刷墙` | 布尔 | **直接写参数名即启用**，无需`=True` |
| `刷墙金币` | `刷墙金币=数字` | 整数 | 刷墙金币阈值 |
| `刷墙圣水` | `刷墙圣水=数字` | 整数 | 刷墙圣水阈值 |
| `刷主世界` | `刷主世界` | 布尔 | 启用主世界打鱼 |
| `刷夜世界` | `刷夜世界` | 布尔 | 启用夜世界打鱼 |
| `英雄` | `英雄=英雄1,英雄2` | 列表 | 欲升级的英雄，逗号分隔 |

> ⚠️ **重要提示**：
>
> - 布尔参数（如`刷墙`、`刷夜世界`）**不能写** `刷墙=True`，直接写参数名即可
> - 未指定的参数会**自动读取UI中的配置**
> - 如果机器人不存在，会使用默认值

### 示例命令

#### 1. 最简单：只启动机器人

```bash
python 主入口.py --机器人 标志=主号
```

使用UI中的所有配置，不做任何修改。

#### 2. 启动并开启刷墙

```bash
python 主入口.py --机器人 标志=主号 刷墙
```

#### 3. 启动并修改最小资源

```bash
python 主入口.py --机器人 标志=主号 最小资源=300000
```

#### 4. 同时启动多个机器人

```bash
python 主入口.py ^
    --机器人 标志=主号 ^
    --机器人 标志=小号1 ^
    --机器人 标志=小号2
```

> `^` 是Windows BAT文件的续行符

#### 5. 多机器人不同配置

```bash
python 主入口.py ^
    --机器人 标志=主号 刷墙 刷夜世界 ^
    --机器人 标志=小号1 最小资源=500000 边缘比例=0.8 ^
    --机器人 标志=小号2 刷主世界
```

#### 6. 指定升级英雄

```bash
python 主入口.py ^
    --机器人 标志=主号 英雄=弓箭女皇,亡灵王子
```

多个英雄用逗号分隔，不要加空格。

---

## 设置Windows计划任务

### 为什么要设置计划任务？

通过Windows计划任务，可以：
- ⏰ 每天固定时间自动启动程序
- 🤖 无需手动操作
- 📅 支持每天、每周、每月等多种计划

### 操作步骤

#### 1. 打开任务计划程序

- 按 `Win + R`
- 输入 `taskschd.msc`
- 回车

#### 2. 创建基本任务

右侧点击 **"创建基本任务"**（或"创建任务"）

#### 3. 填写任务信息

**常规** 选项卡：
- **名称**：如 `COC_Robot_自动启动`
- **描述**：可选，如 `定时启动程序`

#### 4. 设置触发器

**触发器** 选项卡 → 点击 **"新建"**：
- **开始任务**：选择 `按计划`
- **设置**：选择 `每天`
- **开始时间**：如 `上午 09:00`
- **启用**：勾选

#### 5. 设置操作

**操作** 选项卡 → 点击 **"新建"**：
- **操作**：选择 `启动程序`
- **程序或脚本**：填写BAT文件的**完整路径**
  ```
  C:\Users\你的用户名\coc_robot\启动机器人.bat
  ```
- **起始于**（可选）：填写项目目录
  ```
  C:\Users\你的用户名\coc_robot
  ```

#### 6. 保存任务

点击 **"确定"** 保存。

### 测试任务

右键任务 → **"运行"**，查看是否正常启动。

### 修改或删除任务

- **修改**：右键任务 → **"属性"**
- **删除**：右键任务 → **"删除"**

---

## 常见问题

<details>
<summary><b>Q: BAT文件双击后闪退？</b></summary>

可能原因：
1. Python未安装或未添加到PATH
2. 工作目录不对（确保BAT文件在项目根目录）
3. 虚拟环境路径错误

调试方法：
在BAT文件最后添加 `pause`，查看错误信息。
</details>

<details>
<summary><b>Q: 提示"找不到机器人标识"？</b></summary>

确保：
1. 在UI中创建过该机器人配置
2. 标志名称完全一致（区分大小写）
3. 数据库文件 `数据库/任务数据库.db` 存在
</details>

<details>
<summary><b>Q: 如何同时启动5个以上的机器人？</b></summary>

可以在一个BAT文件中添加更多 `--机器人` 参数：

```bat
python 主入口.py ^
    --机器人 标志=号1 ^
    --机器人 标志=号2 ^
    --机器人 标志=号3 ^
    --机器人 标志=号4 ^
    --机器人 标志=号5 ^
    --机器人 标志=号6
```

注意电脑性能限制。
</details>

<details>
<summary><b>Q: 计划任务创建后不执行？</b></summary>

检查：
1. 任务是否启用
2. 触发时间是否正确
3. 用户权限是否足够
4. 电脑在触发时间是否开机

可以在任务属性中查看"历史记录"选项卡，查看执行日志。
</details>

<details>
<summary><b>Q: 参数中的布尔值如何设置？</b></summary>

**错误**：
```bash
--机器人 标志=主号 刷墙=True  # ❌ 错误
```

**正确**：
```bash
--机器人 标志=主号 刷墙  # ✅ 正确
```

直接写参数名即表示启用，不需要 `=True`。
</details>

<details>
<summary><b>Q: 如何在命令行中使用虚拟环境？</b></summary>

在BAT文件中添加激活命令：

```bat
@echo off
cd /d %~dp0
call .venv\Scripts\activate.bat
python 主入口.py --机器人 标志=主号
pause
```

或者使用项目自带的 `激活虚拟环境并启动辅助.bat`。
</details>

---

## 💡 推荐阅读

- [📅 自动启动功能说明](自动启动功能说明.md) - **推荐** - 更简单的UI设置方式
- [🏠 返回主文档](../README.md)
- [🔧 任务开发指南](每日任务开发文档.md) - 开发者文档

---

<div align="center">

**本项目仅供技术学习与研究** ⚠️

</div>
