# 快速开始（开发环境搭建）

> 本教程帮助开发者快速搭建开发环境，开始参与项目开发。

## 前置要求

| 软件 | 版本 | 说明 |
|------|------|------|
| Windows | 10/11 | 操作系统 |
| Python | 3.10.9 | **必须此版本**，其他版本可能依赖出错 |
| Git | 最新版 | 代码版本管理 |
| 雷电模拟器 | 最新版 | 运行游戏 |
| IDE | PyCharm/VSCode | 推荐 PyCharm |

## 第一步：安装 Python 3.10.9

### 下载安装

1. 前往 [Python 官网](https://www.python.org/downloads/release/python-3109/) 下载 **Python 3.10.9**
2. 运行安装程序，**务必勾选** "Add Python to PATH"
3. 验证安装：

```bash
python --version
# 应显示：Python 3.10.9
```

### 常见问题

**Q: 已安装其他版本 Python，怎么办？**

A: 可以使用 [pyenv-win](https://github.com/pyenv-win/pyenv-win) 管理多版本 Python。

## 第二步：安装 Git

1. 前往 [Git 官网](https://git-scm.com/) 下载
2. 安装过程全部默认即可
3. 验证安装：

```bash
git --version
# 应显示：git version 2.xx.x
```

## 第三步：克隆项目

```bash
# 克隆项目
git clone https://github.com/qilishidai/coc_robot.git

# 进入项目目录
cd coc_robot
```

## 第四步：创建虚拟环境（推荐）

```bash
# 创建虚拟环境
python -m venv .venv

# 激活虚拟环境（Windows）
.venv\Scripts\activate

# 看到命令行前面出现 (.venv) 表示成功
# (.venv) C:\Users\YourName\coc_robot>
```

## 第五步：安装依赖

```bash
# 使用清华镜像加速安装
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 常见问题

**Q: 安装失败，提示 "Microsoft Visual C++ 14.0 is required"？**

A: 安装 [Visual Studio Build Tools](https://visualstudio.microsoft.com/visual-cpp-build-tools/)，勾选 "C++ 生成工具"。

**Q: 安装速度很慢？**

A: 确保使用了清华镜像 `-i https://pypi.tuna.tsinghua.edu.cn/simple`

## 第六步：配置雷电模拟器

1. 下载并安装 [雷电模拟器](https://www.ldmnq.com/)
2. 创建新模拟器实例，设置：
   - **分辨率**：`800 × 600`
   - **DPI**：`160`
3. 安装游戏（国际服）
4. 登录游戏账号

### Windows 显示设置

**重要**：确保 Windows 缩放设置为 **100%**

1. 右键桌面 → 显示设置
2. 缩放与布局 → 100%

## 第七步：运行程序

```bash
# 确保在虚拟环境中
# 命令行前应显示 (.venv)

# 启动UI界面
python UI入口.py
```

## 验证开发环境

创建测试文件 `测试环境.py`：

```python
# 测试环境.py

print("=" * 50)
print("开发环境检测")
print("=" * 50)

# 1. 检测 Python 版本
import sys
print(f"Python 版本: {sys.version}")

# 2. 检测核心依赖
try:
    import cv2
    print(f"OpenCV 版本: {cv2.__version__}")
except ImportError:
    print("OpenCV 未安装")

try:
    import numpy as np
    print(f"NumPy 版本: {np.__version__}")
except ImportError:
    print("NumPy 未安装")

try:
    import onnxruntime
    print(f"ONNX Runtime 版本: {onnxruntime.__version__}")
except ImportError:
    print("ONNX Runtime 未安装")

# 3. 检测项目模块
try:
    from 模块.检测 import 线程安全YOLO检测器
    print("YOLO 检测器: OK")
except ImportError as e:
    print(f"YOLO 检测器: 导入失败 - {e}")

try:
    from 模块.检测.模板匹配器 import 模板匹配引擎
    print("模板匹配引擎: OK")
except ImportError as e:
    print(f"模板匹配引擎: 导入失败 - {e}")

print("=" * 50)
print("环境检测完成")
print("=" * 50)
```

运行测试：

```bash
python 测试环境.py
```

## 项目结构概览

```
coc_robot/
├── 任务流程/           # 任务实现代码（开发主要位置）
│   ├── 基础任务框架.py  # 任务基类
│   ├── 主世界打鱼/      # 主世界任务
│   └── 夜世界打鱼/      # 夜世界任务
│
├── 模块/               # 核心模块
│   ├── 检测/           # 图像识别模块
│   │   ├── 模板匹配器.py
│   │   ├── OCR识别器.py
│   │   └── YOLO检测器/
│   └── 雷电模拟器操作类.py
│
├── 核心/               # 底层接口
│   ├── op.py           # 屏幕截图
│   ├── 鼠标操作.py
│   └── 键盘操作.py
│
├── 线程/               # 机器人线程
│   └── 自动化机器人.py
│
├── 界面/               # UI界面
├── 数据库/             # 配置存储
├── 模板/               # 模板图片
└── docs/               # 文档
```

## IDE 配置（PyCharm）

### 配置 Python 解释器

1. 打开 PyCharm
2. File → Settings → Project → Python Interpreter
3. 点击齿轮图标 → Add
4. 选择 "Existing environment"
5. 选择 `.venv\Scripts\python.exe`

### 配置运行

1. Run → Edit Configurations
2. 点击 "+" 添加 Python
3. Script path: `UI入口.py`
4. Working directory: 项目根目录

## 下一步

环境搭建完成后，开始学习开发：

1. **理解架构** → [项目设计思路](./00-项目设计思路.md)
2. **开发任务** → [开发第一个任务](./02-开发第一个任务.md)
3. **提交代码** → [提交贡献](./05-提交贡献.md)

## 常见问题汇总

### 运行时问题

**Q: 提示 "窗口绑定失败"？**

A:
1. 确保雷电模拟器已启动
2. 确保游戏已打开
3. 以管理员身份运行程序

**Q: 提示 "op免注册失败"？**

A:
1. 确保 `核心/op-0.4.5_with_model/` 目录存在
2. 安装 Visual C++ 运行库

**Q: 识别不到游戏画面？**

A:
1. 检查模拟器分辨率是否为 800×600
2. 检查 Windows 缩放是否为 100%
3. 关闭所有滤镜/美化插件

### 开发问题

**Q: 如何调试任务？**

A: 参考 [开发第一个任务](./02-开发第一个任务.md) 中的调试技巧章节。

**Q: 如何添加新的模板图片？**

A: 将 `.bmp` 格式的模板图片放入 `模板/` 目录。

## 相关文档

- [项目设计思路](./00-项目设计思路.md) - 理解项目架构
- [开发第一个任务](./02-开发第一个任务.md) - 手把手教学
- [任务开发进阶](./03-任务开发进阶.md) - OCR、YOLO 高级用法
- [YOLO检测器完整指南](./06-YOLO检测器完整指南.md) - 训练自己的模型
